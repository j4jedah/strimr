(this["webpackJsonpapollo-music-share"]=this["webpackJsonpapollo-music-share"]||[]).push([[0],{187:function(e,t,n){"use strict";n.r(t);var a,i,r=n(0),c=n.n(r),s=n(20),o=n.n(s),l=n(252),u=n(253),d=n(251),j=n(28),b=n(235),p=n(258),g=n(248),O=n(78),m=n.n(O),h=n(102),x=n(81),f=n(29),y=n(254),v=n(221),S=n(260),w=n(224),N=n(225),C=n(255),I=n(226),k=n(227),q=n(228),P=n(229),_=n(230),A=n(82),T=n.n(A),E=n(120),G=n.n(E),R=n(121),F=n.n(R),$=n(49),D=n(256),L=Object(D.a)(a||(a=Object($.a)(["\n    mutation addOrRemoveFromQueue($input: SongInput!) {\n    addOrRemoveFromQueue(input: $input) @client\n  }\n"]))),Q=Object(D.a)(i||(i=Object($.a)(["\n  mutation addSong(\n    $title: String\n    $duration: Float\n    $artist: String\n    $thumbnail: String\n    $url: String\n  ) {\n    insert_songs(\n      objects: {\n        artist: $artist\n        duration: $duration\n        thumbnail: $thumbnail\n        url: $url\n        title: $title\n      }\n    ) {\n      affected_rows\n    }\n  }\n"]))),W=n(5),U=Object(v.a)((function(e){return{container:{display:"flex",alignItems:"center",marginTop:20},urlInput:{margin:e.spacing(1)},addSongBtn:{margin:e.spacing(1)},dialogContent:{textAlign:"center"},thumbnail:{width:"90%",borderRadius:"2%"}}})),J={duration:0,title:"",artist:"",thumbnail:""};var M=function(){var e=Object(y.a)(Q),t=Object(j.a)(e,1)[0],n=c.a.useState(!1),a=Object(j.a)(n,2),i=a[0],r=a[1],s=c.a.useState(""),o=Object(j.a)(s,2),l=o[0],u=o[1],d=c.a.useState(!1),b=Object(j.a)(d,2),p=b[0],g=b[1],O=c.a.useState(J),v=Object(j.a)(O,2),A=v[0],E=v[1];function R(e){var t=e.target,n=t.name,a=t.value;E((function(e){return Object(f.a)(Object(f.a)({},e),{},Object(x.a)({},n,a))}))}function $(){return($=Object(h.a)(m.a.mark((function e(t){var n,a,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.player,!(a=n.player.player).getVideoData){e.next=6;break}i=L(a),e.next=10;break;case 6:if(!a.getCurrentSound){e.next=10;break}return e.next=9,M(a);case 9:i=e.sent;case 10:E(Object(f.a)(Object(f.a)({},i),{},{url:l}));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(){return(D=Object(h.a)(m.a.mark((function e(){var n,a,i,c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{n=A.title,a=A.artist,i=A.thumbnail,c=A.duration,t({variables:{url:l.length>0?l:null,artist:a.length>0?a:null,title:n.length>0?n:null,duration:c>0?c:null,thumbnail:i.length>0?i:null}}),E(J),r(!1),u("")}catch(s){console.error("Error adding song",s)}case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e){var t=e.getDuration(),n=e.getVideoData(),a=n.title,i=n.author,r=n.video_id;return{title:a,duration:t,thumbnail:"https://img.youtube.com/vi/".concat(r,"/0.jpg"),artist:i}}function M(e){return new Promise((function(t){e.getCurrentSound((function(e){e&&t({duration:Number(e.duration/1e3),title:e.title,artist:e.user.username,thumbnail:e.artwork_url.replace("-large","-t500x500")})}))}))}c.a.useEffect((function(){var e=G.a.canPlay(l)||F.a.canPlay(l);g(e)}),[l]);var z=U(),B=z.container,Y=z.addSongBtn,H=z.urlInput,V=z.dialogContent,K=z.thumbnailStyle,X=A.thumbnail,Z=A.title,ee=A.artist;return Object(W.jsxs)("div",{className:B,children:[Object(W.jsxs)(S.a,{className:V,open:i,onClose:!1,children:[Object(W.jsx)(w.a,{children:"Add song"}),Object(W.jsxs)(N.a,{children:[Object(W.jsx)("img",{className:K,src:X,alt:"Video thumbnail"}),Object(W.jsx)(C.a,{onChange:R,value:Z,type:"text",fullWidth:!0,margin:"dense",label:"Title",name:"title",required:!0}),Object(W.jsx)(C.a,{onChange:R,value:ee,type:"text",fullWidth:!0,margin:"dense",name:"artist",label:"Artist",required:!0}),Object(W.jsx)(C.a,{onChange:R,value:X,type:"text",fullWidth:!0,margin:"dense",name:"thumbnail",label:"Song thumbnail",required:!0}),Object(W.jsx)(C.a,{onChange:R,value:l,fullWidth:!0,margin:"dense",name:"url",label:"URL",required:!0})]}),Object(W.jsxs)(I.a,{children:[Object(W.jsx)(k.a,{color:"secondary",onClick:function(){return r(!1)},children:"Cancel"}),Object(W.jsx)(k.a,{onClick:function(){return D.apply(this,arguments)},color:"primary",variant:"outlined",children:"Add song"})]})]}),Object(W.jsx)(C.a,{onChange:function(e){return u(e.target.value)},value:l,className:H,type:"url",fullWidth:!0,margin:"normal",placeholder:"Add Soundcloud or Youtube URL",InputProps:{startAdornment:Object(W.jsx)(q.a,{position:"start",children:Object(W.jsx)(P.a,{})})}}),Object(W.jsx)(k.a,{disabled:!p,onClick:function(e){r(!0)},className:Y,variant:"contained",color:"primary",endIcon:Object(W.jsx)(_.a,{}),children:"Add"}),Object(W.jsx)(T.a,{url:l,hidden:!0,onReady:function(e){return $.apply(this,arguments)}})]})},z=n(231),B=n(141),Y=n(232),H=n(233),V=Object(v.a)((function(e){return{title:{marginLeft:20}}}));var K,X=function(){var e=V().title;return Object(W.jsx)("div",{children:Object(W.jsx)(z.a,{position:"fixed",children:Object(W.jsxs)(Y.a,{children:[Object(W.jsx)(H.a,{}),Object(W.jsx)(B.a,{variant:"h6",component:"h1",className:e,children:"Apollo Music Share"})]})})})},Z=n(263),ee=n(234),te=n(236),ne=n(237),ae=n(238),ie=n(239),re=n(240),ce=n(241),se=n(242),oe=n(243),le=Object(D.a)(K||(K=Object($.a)(["\n    subscription getSongs {\n        songs(order_by: {created_at: desc}) {\n        artist\n        title\n        thumbnail\n        url\n        id\n        duration\n    }\n}\n\n"]))),ue=Object(v.a)((function(e){return{container:{margin:e.spacing(3)},songInfoContainer:{display:"flex",alignItems:"center"},songContainer:{display:"flex",alignItems:"center"},thumbnail:{objectFit:"cover",width:150,height:150},songInfo:{width:"100%",display:"flex",justifyContent:"space-between"},title:{minWidth:100,maxHeight:50,textOverflow:"ellipsis",overflow:"hidden"}}}));function de(e){var t=e.song,n=ue(),a=Object(b.a)((function(e){return e.breakpoints.up("xs")})),i=Object(y.a)(L,{onCompleted:function(e){return localStorage.setItem("queue",JSON.stringify(e.addOrRemoveFromQueue))}}),r=Object(j.a)(i,1)[0],s=c.a.useContext(ke),o=s.state,l=s.dispatch,u=c.a.useState(!1),d=Object(j.a)(u,2),p=d[0],g=d[1];return c.a.useEffect((function(){var e=o.isPlaying&&t.id===o.song.id;g(e)}),[t.id,o.isPlaying,o.song.id]),Object(W.jsx)(te.a,{className:n.container,children:Object(W.jsxs)("div",{className:n.songInfoContainer,children:[Object(W.jsx)(ne.a,{image:t.thumbnail,className:n.thumbnail}),Object(W.jsxs)("div",{className:n.songInfo,children:[Object(W.jsxs)(ae.a,{children:[Object(W.jsx)(B.a,{className:n.title,style:{display:a?"":"none"},gutterBottom:!0,variant:"h5",component:"h2",children:t.title}),Object(W.jsx)(B.a,{variant:"body1",component:"p",color:"textSecondary",children:t.artist})]}),Object(W.jsxs)(ie.a,{children:[Object(W.jsx)(re.a,{onClick:function(){l({type:"SET_SONG",payload:{song:t}}),l(o.isPlaying?{type:"PAUSE_SONG"}:{type:"PLAY_SONG"})},size:"small",color:"primary",children:p?Object(W.jsx)(ce.a,{}):Object(W.jsx)(se.a,{})}),Object(W.jsx)(re.a,{onClick:function(){r({variables:{input:Object(f.a)(Object(f.a)({},t),{},{__typename:"Song"})}})},size:"small",color:"secondary",children:Object(W.jsx)(oe.a,{})})]})]})]})})}var je,be=function(){var e=Object(Z.a)(le),t=e.data,n=e.loading,a=e.error;return n?Object(W.jsx)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column",marginTop:50},children:Object(W.jsx)(ee.a,{})}):a?Object(W.jsxs)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column",marginTop:50},children:["Error loading song lists.... Try again later",console.log(a)]}):Object(W.jsx)("div",{children:t.songs.map((function(e){return Object(W.jsx)(de,{song:e},e.id)}))})},pe=n(259),ge=n(262),Oe=n(245),me=n(246),he=n(247),xe=Object(D.a)(je||(je=Object($.a)(["\n  query getQueuedSongs {\n    queue @client {\n      id\n      title\n      artist\n      thumbnail\n      duration\n      url\n    }\n  }\n"]))),fe=n(261),ye=n(244);var ve=Object(v.a)((function(e){return{avatar:{width:64,height:64},text:{overflow:"hidden",textOverflow:"ellipsis"},container:{display:"grid",gridAutoFlow:"column",gridTemplateColumns:"50px auto 50px",gridGap:40,alignItems:"center",marginTop:30},songInfoContainer:{overflow:"hidden",whiteSpace:"nowrap"}}}));function Se(e){var t=e.song,n=ve(),a=Object(y.a)(L,{onCompleted:function(e){localStorage.setItem("queue",JSON.stringify(e.addOrRemoveFromQueue))}}),i=Object(j.a)(a,1)[0];return Object(W.jsxs)("div",{className:n.container,children:[Object(W.jsx)(fe.a,{src:t.thumbnail,alt:"Song thumbnail",className:n.avatar}),Object(W.jsxs)("div",{className:n.songInfoContainer,children:[Object(W.jsx)(B.a,{variant:"subtitle2",className:n.text,children:t.title}),Object(W.jsx)(B.a,{color:"textSecondary",variant:"body2",className:n.text,children:t.artist})]}),Object(W.jsx)(re.a,{onClick:function(){window.confirm("Are you sure you want to remove song from playlist?")&&i({variables:{input:Object(f.a)(Object(f.a)({},t),{},{__typename:"Song"})}})},children:Object(W.jsx)(ye.a,{color:"error"})})]})}var we=function(e){var t=e.queue;return Object(b.a)((function(e){return e.breakpoints.up("md")}))&&Object(W.jsxs)("div",{style:{margin:"10px 0"},children:[Object(W.jsxs)(B.a,{variant:"button",color:"textSecondary",children:["Playlist (",t.length,")"]}),Object(W.jsx)("div",{style:{"::Webkitscrollbar?":{display:"none"},maxHeight:550,overflow:"auto",scrollbarWidth:"none"},children:t.map((function(e,t){return Object(W.jsx)(Se,{song:e},t)}))})]})},Ne=Object(v.a)((function(e){return{container:{display:"flex",justifyContent:"space-between"},details:{display:"flex",flexDirection:"column",padding:"0 15px"},content:{flex:"1 0 auto"},thumbnail:{width:150},controls:{display:"flex",alignItems:"center",paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},playIcon:{height:38,width:38}}}));var Ce=function(){var e=c.a.useContext(ke),t=e.state,n=e.dispatch,a=c.a.useState(0),i=Object(j.a)(a,2),r=i[0],s=i[1],o=Object(pe.a)(xe).data;c.a.useEffect((function(){var e=o.queue.findIndex((function(e){return e.id===t.song.id}));s(e)}),[o.queue,t.song.id]);var l=c.a.useState(0),u=Object(j.a)(l,2),d=u[0],b=u[1];c.a.useEffect((function(){var e=o.queue[r+1];d>=.99&&e&&(b(0),n({type:"SET_SONG",payload:{song:e}}))}),[o.queue,n,d,r]);var p,g=c.a.useState(!1),O=Object(j.a)(g,2),m=O[0],h=O[1],x=c.a.useState(0),f=Object(j.a)(x,2),y=f[0],v=f[1],S=c.a.useRef(),w=Ne();return Object(W.jsxs)(W.Fragment,{children:[Object(W.jsxs)(te.a,{variant:"outlined",className:w.container,children:[Object(W.jsxs)("div",{className:w.details,children:[Object(W.jsxs)(ae.a,{className:w.content,children:[Object(W.jsx)(B.a,{variant:"h5",component:"h3",children:t.song.title}),Object(W.jsx)(B.a,{variant:"subtitle1",component:"p",color:"textSecondary",children:t.song.artist})]}),Object(W.jsxs)("div",{className:w.controls,children:[Object(W.jsx)(re.a,{children:Object(W.jsx)(Oe.a,{onClick:function(){var e=o.queue[r-1];e&&n({type:"SET_SONG",payload:{song:e}})}})}),Object(W.jsx)(re.a,{onClick:function(){n(t.isPlaying?{type:"PAUSE_SONG"}:{type:"PLAY_SONG"})},children:t.isPlaying?Object(W.jsx)(me.a,{className:w.playIcon}):Object(W.jsx)(se.a,{className:w.playIcon})}),Object(W.jsx)(re.a,{children:Object(W.jsx)(he.a,{onClick:function(){var e=o.queue[r+1];e&&n({type:"SET_SONG",payload:{song:e}})}})}),Object(W.jsxs)(B.a,{variant:"subtitle1",component:"p",color:"textSecondary",children:[(p=y,new Date(1e3*p).toISOString().substr(11,8))," "]})]}),Object(W.jsx)(ge.a,{onChange:function(e,t){b(t)},onMouseDown:function(){h(!0)},onMouseUp:function(){h(!1),S.current.seekTo(d)},value:d,type:"range",min:0,max:1,step:.01})]}),Object(W.jsx)(T.a,{ref:S,onProgress:function(e){var t=e.played,n=e.playedSeconds;m||(b(t),v(n))},playing:t.isPlaying,url:t.song.url,hidden:!0}),Object(W.jsx)(ne.a,{className:w.thumbnail,loading:"lazy",image:t.song.thumbnail})]}),Object(W.jsx)(we,{queue:o.queue})]})};var Ie=function(e,t){switch(t.type){case"PLAY_SONG":return Object(f.a)(Object(f.a)({},e),{},{isPlaying:!0});case"PAUSE_SONG":return Object(f.a)(Object(f.a)({},e),{},{isPlaying:!1});case"SET_SONG":return Object(f.a)(Object(f.a)({},e),{},{song:t.payload.song});default:return e}},ke=c.a.createContext({song:{id:"d6feea7f-29c5-41cb-a13f-ef38663e63b4",artist:"Sia",title:"The Greatest",duration:352,url:"https://www.youtube.com/watch?v=GKSRyLdjsPA",thumbnail:"https://img.youtube.com/vi/GKSRyLdjsPA/0.jpg"},isPlaying:!1});var qe,Pe=function(){var e=c.a.useContext(ke),t=Object(r.useReducer)(Ie,e),n=Object(j.a)(t,2),a=n[0],i=n[1],s=Object(b.a)((function(e){return e.breakpoints.up("sm")})),o=Object(b.a)((function(e){return e.breakpoints.up("md")}));return Object(W.jsxs)(ke.Provider,{value:{state:a,dispatch:i},children:[Object(W.jsx)(p.a,{only:"xs",children:Object(W.jsx)(X,{})}),Object(W.jsxs)(g.a,{container:!0,spacing:3,children:[Object(W.jsxs)(g.a,{item:!0,xs:12,md:7,style:{paddingTop:s?80:10},children:[Object(W.jsx)(M,{}),Object(W.jsx)(be,{})]}),Object(W.jsx)(g.a,{item:!0,xs:12,md:5,style:o?{position:"fixed",top:70,right:0,width:"100%"}:{position:"fixed",left:0,bottom:0,width:"100%"},children:Object(W.jsx)(Ce,{})})]})]})},_e=n(134),Ae=n(249),Te=n(250),Ee=Object(_e.a)({palette:{type:"dark",primary:Ae.a,secondary:Te.a}}),Ge=n(135),Re=n(128),Fe=n(137),$e=n(136),De=new Re.a({link:new Fe.a({uri:"wss://apollo-music-share-1.hasura.app/v1/graphql",options:{reconnect:!0,connectionParams:{headers:{contentType:"application/json","x-hasura-admin-secret":"NXkXfGTskTmL3RQ35Ewazaov5oAhJuk22j77eHdiN3tD5zpIUCcedkaLf86vSq13"}}}}),cache:new $e.a,typeDefs:Object(D.a)(qe||(qe=Object($.a)(["\n    type Song {\n      id: uuid\n      title: String\n      artist: String\n      duration: Float\n      thumbnail: String\n      url: String\n    }\n    input SongInput {\n      id: uuid\n      title: String\n      artist: String\n      duration: Float\n      thumbnail: String\n      url: String\n    }\n    type Query {\n      queue: [Song]!\n    }\n    type Mutation {\n      addOrRemoveFromQueue(input: SongInput!): [Song]!\n    }\n  "]))),resolvers:{Mutation:{addOrRemoveFromQueue:function(e,t,n){var a=t.input,i=n.cache,r=i.readQuery({query:xe});if(r){var c=r.queue,s=c.some((function(e){return e.id===a.id}))?c.filter((function(e){return e.id!==a.id})):[].concat(Object(Ge.a)(c),[a]);return i.writeQuery({query:xe,data:{queue:s}}),s}return[]}}}}),Le={queue:Boolean(localStorage.getItem("queue"))?JSON.parse(localStorage.getItem("queue")):[]};De.writeData({data:Le});var Qe=De;o.a.render(Object(W.jsx)(c.a.StrictMode,{children:Object(W.jsx)(d.a,{client:Qe,children:Object(W.jsxs)(l.a,{theme:Ee,children:[Object(W.jsx)(u.a,{}),Object(W.jsx)(Pe,{})]})})}),document.getElementById("root"))}},[[187,1,2]]]);
//# sourceMappingURL=main.7f4b5f52.chunk.js.map